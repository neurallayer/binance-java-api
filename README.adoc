= Java Binance API

image:https://img.shields.io/github/languages/code-size/neurallayer/binance-java-api[GitHub code size]
image:https://img.shields.io/github/last-commit/neurallayer/binance-java-api[[GitHub last commit]
image:https://img.shields.io/maven-central/v/org.roboquant/binance-api-client[?color=blue&[Maven Central]
image:https://sonarcloud.io/api/project_badges/measure?project=neurallayer_binance-java-api&metric=security_rating[Security Rating, link=https://sonarcloud.io/component_measures?metric=new_security_rating&view=list&id=neurallayer_binance-java-api]

image::/docs/roboquant_header.png[roboquant Logo, align="center", link="https://roboquant.org"]

This version of the Java Binance client API is maintained as part of roboquant.

_Roboquant_ is an algorithmic trading platform that is very fast and flexible while at the same time strives to be easy to use. It is fully open source, written in Kotlin, and can be used in Jupyter Notebooks as well as standalone JVM applications.

You can find out more at *https://roboquant.org[roboquant.org]*.


== Binance client

The binance-java-api is a lightweight Java library for interacting with the https://developers.binance.com/docs/api/scopes[Binance API], providing complete API coverage, and supporting synchronous and asynchronous requests, as well as event streaming using WebSockets.

This is repo contains a fork of the original repo with a few important changes:

* Patched releases to Maven Central repo so they can be easily included in your own application
* Added missing attributes to the Java classes, so there are no exceptions with newer JSON responses
* Upgraded retrofit2 library
* Fixed warnings in the Maven build
* Added required release functionality to `pom.xml` file
* Upgraded `jackson-databind` due to a vulnerability
* Use group-id `org.roboquant` (stay compliant with Maven Central regarding owning the domain name linked to the group-id)

In the future we might also include some of the pending PR's from the main repo, especially those that reflect changes to the Binance API.

Package- and class-names are not changed and so this should be a drop-in replacement.

== Features

* Support for synchronous and asynchronous REST requests to all https://www.binance.com/restapipub.html#user-content-general-endpoints[General], https://www.binance.com/restapipub.html#user-content-market-data-endpoints[Market Data], https://www.binance.com/restapipub.html#user-content-account-endpoints[Account] endpoints, and https://www.binance.com/restapipub.html#user-content-user-data-stream-endpoints[User] stream endpoints.
* Support for User Data, Trade, Kline, and Depth event streaming using https://www.binance.com/restapipub.html#wss-endpoint[Binance WebSocket API].

== Installation

image:https://maven-badges.herokuapp.com/maven-central/org.roboquant/binance-api-client/badge.svg[Maven Central,link=https://maven-badges.herokuapp.com/maven-central/org.roboquant/binance-api-client]

=== Maven
Add the dependency to your pom.xml file.

----
<dependency>
  <groupId>org.roboquant</groupId>
  <artifactId>binance-api-client</artifactId>
  <version>1.0.5</version>
</dependency>

----

=== Gradle
Add the dependency to your gradle build file

----
dependencies {
	implementation 'org.roboquant:binance-api-client:1.0.5'
}
----

== Examples

=== Getting Started

There are three main client classes that can be used to interact with the API:

. https://github.com/joaopsilva/binance-java-api/blob/master/src/main/java/com/binance/api/client/BinanceApiRestClient.java[`BinanceApiRestClient`], a synchronous/blocking https://www.binance.com/restapipub.html[Binance API] client;
. https://github.com/joaopsilva/binance-java-api/blob/master/src/main/java/com/binance/api/client/BinanceApiAsyncRestClient.java[`BinanceApiAsyncRestClient`], an asynchronous/non-blocking https://www.binance.com/restapipub.html[Binance API] client;
. https://github.com/joaopsilva/binance-java-api/blob/master/src/main/java/com/binance/api/client/BinanceApiWebSocketClient.java[`BinanceApiWebSocketClient`], a data streaming client using https://www.binance.com/restapipub.html#wss-endpoint[Binance WebSocket API].

These can be instantiated through the corresponding factory method of https://github.com/joaopsilva/binance-java-api/blob/master/src/main/java/com/binance/api/client/BinanceApiClientFactory.java[`BinanceApiClientFactory`], by passing the https://www.binance.com/restapipub.html#user-content-endpoint-security-type[security parameters] `API-KEY` and `SECRET`, which can be created at https://www.binance.com/userCenter/createApi.html.

[source,java]
----
BinanceApiClientFactory factory = BinanceApiClientFactory.newInstance("API-KEY", "SECRET");
BinanceApiRestClient client = factory.newRestClient();
----

If the client only needs to access endpoints which do not require additional security, then these parameters are optional.

Once the client is instantiated, it is possible to start making requests to the API.

=== General endpoints

==== Test connectivity

[source,java]
----
client.ping();
----

==== Check server time

[source,java]
----
long serverTime = client.getServerTime();
System.out.println(serverTime);
----

=== Market Data endpoints

==== Order book of a symbol

[source,java]
----
OrderBook orderBook = client.getOrderBook("NEOETH", 10);
List<OrderBookEntry> asks = orderBook.getAsks();
OrderBookEntry firstAskEntry = asks.get(0);
System.out.println(firstAskEntry.getPrice() + " / " + firstAskEntry.getQty());
----

==== Compressed/Aggregate trades list of a symbol

[source,java]
----
List<AggTrade> aggTrades = client.getAggTrades("NEOETH");
System.out.println(aggTrades);
----

==== Weekly candlestick bars for a symbol

[source,java]
----
List<Candlestick> candlesticks = client.getCandlestickBars("NEOETH", CandlestickInterval.WEEKLY);
System.out.println(candlesticks);
----

==== Latest price of a symbol

[source,java]
----
TickerStatistics tickerStatistics = client.get24HrPriceStatistics("NEOETH");
System.out.println(tickerStatistics.getLastPrice());
----

==== Getting all latests prices

[source,java]
----
List<TickerPrice> allPrices = client.getAllPrices();
System.out.println(allPrices);
----

=== Account Data endpoints

==== Get account balances

[source,java]
----
Account account = client.getAccount();
System.out.println(account.getBalances());
System.out.println(account.getAssetBalance("ETH").getFree());
----

==== Get list of trades for an account and a symbol

[source,java]
----
List<Trade> myTrades = client.getMyTrades("NEOETH");
System.out.println(myTrades);
----

==== Get account open orders for a symbol

[source,java]
----
List<Order> openOrders = client.getOpenOrders(new OrderRequest("LINKETH"));
System.out.println(openOrders);
----

==== Get order status

[source,java]
----
Order order = client.getOrderStatus(new OrderStatusRequest("LINKETH", 12345L));
System.out.println(order.getExecutedQty());
----

==== Placing a MARKET order

[source,java]
----
NewOrderResponse newOrderResponse = client.newOrder(marketBuy("LINKETH", "1000").orderRespType(OrderResponseType.FULL));
List<Trade> fills = newOrderResponse.getFills();
System.out.println(newOrderResponse.getClientOrderId());
----

==== Placing a LIMIT order

[source,java]
----
NewOrderResponse newOrderResponse = client.newOrder(limitBuy("LINKETH", TimeInForce.GTC, "1000", "0.0001"));
System.out.println(newOrderResponse.getTransactTime());
----

==== Canceling an order

[source,java]
----
client.cancelOrder(new CancelOrderRequest("LINKETH", 123015L));
----

==== Withdraw

In order to be able to withdraw programatically, please enable the `Enable Withdrawals` option in the API settings.

[source,java]
----
client.withdraw("ETH", "0x123", "0.1", null);
----

==== Fetch withdraw history

[source,java]
----
WithdrawHistory withdrawHistory = client.getWithdrawHistory("ETH");
System.out.println(withdrawHistory);
----

==== Fetch deposit history

[source,java]
----
DepositHistory depositHistory = client.getDepositHistory("ETH");
System.out.println(depositHistory);
----

==== Get deposit address

[source,java]
----
DepositAddress depositAddress = client.getDepositAddress("ETH");
System.out.println(depositAddress);
----

=== User stream endpoints

==== Start user data stream, keepalive, and close data stream

[source,java]
----
String listenKey = client.startUserDataStream();
client.keepAliveUserDataStream(listenKey);
client.closeUserDataStream(listenKey);
----

=== WebSocket API

==== Initialize the WebSocket client

[source,java]
----
BinanceApiWebSocketClient client = BinanceApiClientFactory.newInstance().newWebSocketClient();
----

User needs to be aware that REST symbols which are `upper case` differ from WebSocket symbols which must be `lower case`.
In scenario of subscription with upper case styled symbol, server will return no error and subscribe to given channel - however, no events will be pushed. 

==== Handling web socket errors

Each of the methods on `BinanceApiWebSocketClient`, which opens a new web socket, takes a `BinanceApiCallback`, which is
called for each event received from the Binance servers. 

The `BinanceApiCallback` interface also has a `onFailure(Throwable)` method, which, optionally, can be implemented to
receive notifications if the web-socket fails, e.g. disconnection. 

[source,java]
----
client.onAggTradeEvent(symbol.toLowerCase(), new BinanceApiCallback<AggTradeEvent>() {
    @Override
    public void onResponse(final AggTradeEvent response) {
        System.out.println(response);
    }

    @Override
    public void onFailure(final Throwable cause) {
        System.err.println("Web socket failed");
        cause.printStackTrace(System.err);
    }
});
----

==== Closing web sockets

Each of the methods on `BinanceApiWebSocketClient`, which opens a new web socket, also returns a `Closeable`.
This `Closeable` can be used to close the underlying web socket and free any associated resources, e.g.

[source,java]
----
Closable ws = client.onAggTradeEvent("ethbtc", someCallback);
// some time later...
ws.close();
----

==== Listen for aggregated trade events for ETH/BTC

[source,java]
----
client.onAggTradeEvent("ethbtc", (AggTradeEvent response) -> {
  System.out.println(response.getPrice());
  System.out.println(response.getQuantity());
});
----

==== Listen for changes in the order book for ETH/BTC

[source,java]
----
client.onDepthEvent("ethbtc", (DepthEvent response) -> {
  System.out.println(response.getAsks());
});
----

==== Get 1m candlesticks in real-time for ETH/BTC

[source,java]
----
client.onCandlestickEvent("ethbtc", CandlestickInterval.ONE_MINUTE, response -> System.out.println(response));
----

==== Keep a local depth cache for a symbol

Please see https://github.com/joaopsilva/binance-java-api/blob/master/src/test/java/com/binance/api/examples/DepthCacheExample.java[DepthCacheExample.java] for an implementation which uses the binance-java-api for maintaining a local depth cache for a symbol. In the same folder, you can also find how to do caching of account balances, aggregated trades, and klines/candlesticks.

==== Listen for changes in the account

[source,java]
----
client.onUserDataUpdateEvent(listenKey, response -> {
  if (response.getEventType() == UserDataUpdateEventType.ACCOUNT_UPDATE) {
    AccountUpdateEvent accountUpdateEvent = response.getAccountUpdateEvent();
    
    // Print new balances of every available asset
    System.out.println(accountUpdateEvent.getBalances());
  } else {
    OrderTradeUpdateEvent orderTradeUpdateEvent = response.getOrderTradeUpdateEvent();
    
    // Print details about an order/trade
    System.out.println(orderTradeUpdateEvent);

    // Print original quantity
    System.out.println(orderTradeUpdateEvent.getOriginalQuantity());

    // Or price
    System.out.println(orderTradeUpdateEvent.getPrice());
  }
});
----

==== Multi-channel subscription

Client provides a way for user to subscribe to multiple channels using same websocket - to achieve that user needs to coma-separate symbols as it is in following examples.

[source,java]
----
client.onAggTradeEvent("ethbtc,ethusdt", (AggTradeEvent response) -> {
  if (Objects.equals(response.getSymbol(),"ethbtc")) {
      // handle ethbtc event
  } else if(Objects.equals(response.getSymbol()),"ethusdt")) {
      // handle ethusdt event
  }
});
----

[source,java]
----
client.onDepthEvent("ethbtc,ethusdt", (DepthEvent response) -> {
  if (Objects.equals(response.getSymbol(),"ethbtc")) {
      // handle ethbtc event
  } else if(Objects.equals(response.getSymbol()),"ethusdt")) {
      // handle ethusdt event
  }
});
----

[source,java]
----
client.onCandlestickEvent("ethbtc,ethusdt", CandlestickInterval.ONE_MINUTE, (CandlestickEvent response) -> {
  if (Objects.equals(response.getSymbol(),"ethbtc")) {
      // handle ethbtc event
  } else if(Objects.equals(response.getSymbol()),"ethusdt")) {
      // handle ethusdt event
  }
});
----

=== Asynchronous requests

To make an asynchronous request it is necessary to use the `BinanceApiAsyncRestClient`, and call the method with the same name as in the synchronous version, but passing a callback https://github.com/joaopsilva/binance-java-api/blob/master/src/main/java/com/binance/api/client/BinanceApiCallback.java[`BinanceApiCallback`] that handles the response whenever it arrives.

==== Get latest price of a symbol asynchronously

[source,java]
----
client.get24HrPriceStatistics("NEOETH", (TickerStatistics response) -> {
  System.out.println(response.getLastPrice());
  System.out.println(response.getVolume());
});
----

==== Placing a LIMIT order asynchronously

[source,java]
----
client.newOrder(limitBuy("LINKETH", TimeInForce.GTC, "1000", "0.0001"), (NewOrderResponse response) -> {
  System.out.println(response.getTransactTime());
});
----

=== Exception handling

Every API method can potentially throw an unchecked `BinanceApiException` which wraps the error message returned from the Binance API, or an exception, in case the request never properly reached the server.

[source,java]
----
try {
  client.getOrderBook("UNKNOWN", 10);
} catch (BinanceApiException e) {
  System.out.println(e.getError().getCode()); // -1121
  System.out.println(e.getError().getMsg());  // Invalid symbol
}
----

=== More examples
An extensive set of examples, covering most aspects of the API, can be found at https://github.com/joaopsilva/binance-java-api/tree/master/src/test/java/com/binance/api/examples.